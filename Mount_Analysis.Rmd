---
title: "Mount_Analysis"
author: "Jay Falk"
date: "5/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load necessary packages
```{r load-library, message = FALSE}
library(tidyverse)
```

Load stored datasets
```{r datasets, message = FALSE}
longcomplete <- read_csv("FirstReaction_gittrack.csv")
```

Data shaping for analysis
```{r}
#First filter out the trials where no behaviors happened at all
nona <- longcomplete %>%
  mutate(sumthing = if_else(feed == 0 & attack == 0 & tail == 0 & court == 0 & cop == 0, 0, 1)) %>%
  filter(sumthing == 1) %>%
  select(-sumthing)

#Make some categories based on the presence of certain types
testcategories_nona <- nona %>%
  mutate(Fpresent = if_else(test == "M/MLF", 0, 1)) %>%
  mutate(Mpresent = if_else(test == "F/MLF", 0, 1)) %>%
  mutate(MLFpresent = if_else(test == "M/F", 0, 1))
```

Let's first look at sexual behavior
```{r}
courtscops_nona <- testcategories_nona %>%
  mutate(sumthing = if_else(court == 0 & cop == 0, 0, 1)) %>%
  filter(sumthing == 1) %>%
  select(date, trial, test, type, court, cop)

replace_na(courtscops_nona$court,0)
replace_na(courtscops_nona$cop,0)
```

Feed behavior. First look at whether there are differences between types of interactors in who they choose to feed with. Types are androchromes, heterochromes, Amazilias, and Other
```{r}
#Do types of birds differ in the way they interact with males versus heterochrome females? 
mf <- testcategories_nona %>% 
  filter(test == "M/F") %>%
  filter(feed != 0)
mffeedtable <- table(mf$type, mf$feed)
prop.table(mffeedtable, m=1)
chisq.test(mffeedtable)

#Do types of birds differ in the way they interact with androchrome females versus heterochrome females? 
fmlf <- testcategories_nona %>% 
  filter(test == "F/MLF") %>%
  filter(feed != 0)
fmlffeedtable <- table(fmlf$type, fmlf$feed)
prop.table(fmlffeedtable, m=1)
chisq.test(fmlffeedtable)

#Do types of birds differ in the way they interact with androchrome females versus males? 
mmlf <- testcategories_nona %>% 
  filter(test == "M/MLF") %>%
  filter(feed != 0)
mmlffeedtable <- table(mmlf$type, mmlf$feed)
prop.table(mmlffeedtable, m=1)
chisq.test(mmlffeedtable)
```

Are mounts fed with at different rates? Androchromes seem to be doing something different than the other types of birds in the male versus heterochrome female test type. See what happens if we take them out. 
```{r}
#Do all hummingbirds feed with male versus heterochrome female mounts at different rates? 
mf <- testcategories_nona %>% 
  filter(test == "M/F") %>%
  filter(feed != 0)
mffeedtable <- table(mf$feed)
prop.table(mffeedtable)
chisq.test(mffeedtable)

#What about if we take out the androchromes?  
mf <- testcategories_nona %>% 
  filter(test == "M/F") %>%
  filter(feed != 0) %>%
  filter(type != "Flom")
mffeedtable <- table(mf$feed)
prop.table(mffeedtable)
chisq.test(mffeedtable)


#Do all hummingbirds feed with androchrome female versus heterochrome female mounts at different rates? 
fmlf <- testcategories_nona %>% 
  filter(test == "F/MLF") %>%
  filter(feed != 0)
fmlffeedtable <- table(fmlf$feed)
prop.table(fmlffeedtable)
chisq.test(fmlffeedtable)

#What about if we take out the androchromes?  
fmlf <- testcategories_nona %>% 
  filter(test == "F/MLF") %>%
  filter(feed != 0) %>%
  filter(type != "Flom")
fmlffeedtable <- table(fmlf$feed)
prop.table(fmlffeedtable)
chisq.test(fmlffeedtable)



#Do all hummingbirds feed with males versus androchrome female mounts at different rates? 
mmlf <- testcategories_nona %>% 
  filter(test == "M/MLF") %>%
  filter(feed != 0)
mmlffeedtable <- table(mmlf$feed)
prop.table(mmlffeedtable)
chisq.test(mmlffeedtable)

#What about if we take out the androchromes?  
mmlf <- testcategories_nona %>% 
  filter(test == "M/MLF") %>%
  filter(feed != 0) %>%
  filter(type != "Flom")
mmlffeedtable <- table(mmlf$feed)
prop.table(mmlffeedtable)
chisq.test(mmlffeedtable)
```

Attack behavior. First look at whether there are differences between types of interactors in who they choose to attack. Types are androchromes, heterochromes, Amazilias, and Other.
```{r}
#Do types of birds differ in the way they attack males versus heterochrome females? 
mf <- testcategories_nona %>% 
  filter(test == "M/F") %>%
  filter(attack != 0)
mfattacktable <- table(mf$type, mf$attack)
prop.table(mfattacktable, m=1)
chisq.test(mfattacktable)

#Do types of birds differ in the way they attack androchrome females versus heterochrome females? 
fmlf <- testcategories_nona %>% 
  filter(test == "F/MLF") %>%
  filter(attack != 0)
fmlfattacktable <- table(fmlf$type, fmlf$attack)
prop.table(fmlfattacktable, m=1)
chisq.test(fmlfattacktable)

#Do types of birds differ in the way they attack androchrome females versus males? 
mmlf <- testcategories_nona %>% 
  filter(test == "M/MLF") %>%
  filter(attack != 0)
mmlfattacktable <- table(mmlf$type, mmlf$attack)
prop.table(mmlfattacktable, m=1)
chisq.test(mmlfattacktable)
```

Are mounts fed with at different rates? Androchromes seem to be doing something different than the other types of birds in the male versus heterochrome female test type. See what happens if we take them out. 
```{r}
mf <- testcategories_nona %>% 
  filter(test == "M/F") %>%
  filter(attack != 0)
mfattacktable <- table(mf$attack)
prop.table(mfattacktable)
chisq.test(mfattacktable)

fmlf <- testcategories_nona %>% 
  filter(test == "F/MLF") %>%
  filter(attack != 0)
fmlfattacktable <- table(fmlf$attack)
prop.table(fmlfattacktable)
chisq.test(fmlfattacktable)

mmlf <- testcategories_nona %>% 
  filter(test == "M/MLF") %>%
  filter(attack != 0)
mmlfattacktable <- table(mmlf$attack)
prop.table(mmlfattacktable)
chisq.test(mmlfattacktable)
```

This looks at sex behavior of males toward the mounts. First need to shape the data a bit 
```{r}
#Find all the instances where courtship or copulation happened, and take out the ones where it didn't
courtscops_nona <- testcategories_nona %>%
  mutate(sumthing = if_else(court == 0 & cop == 0, 0, 1)) %>%
  filter(sumthing == 1) %>%
  select(date, trial, test, type, court, cop) %>%
  replace_na(list(court = 0, cop = 0))

#This combines courtship and copulation. If courtship happened, it takes the courtship choice. If not, but copulation happened, it takes the copulation choice
courtscops_combine <- courtscops_nona %>%
  mutate(combine = if_else(court != 0, court, cop))
```

Who did androchromes choose to direct sexual behavior toward? 
```{r}
#All chose F first in M/F tests
mf <- courtscops_combine %>% filter(test == "M/F") 

#All chose F first in M/MLF
fmlf <- courtscops_combine %>% filter(test == "F/MLF")

#Some choice MLF and some chose M in M/MLF tests
mmlf <- courtscops_combine %>% 
  filter(test == "M/MLF")
mmlfcourtcoptable <- table(mmlf$combine)
prop.table(mmlfcourtcoptable)
chisq.test(mmlfcourtcoptable)
```

